# ioBroker MCDU Adapter - JSON Config Implementation Plan

**Goal:** Build the entire admin UI using ioBroker's native JSON Config system - **NO custom React code**.

---

## Why JSON Config?

‚úÖ **Zero custom UI code** - Everything declared in `admin/jsonConfig.json`
‚úÖ **Native ioBroker components** - Tables, selects, inputs all built-in
‚úÖ **Automatic state management** - Config changes handled by ioBroker
‚úÖ **Responsive & accessible** - Professional UI without writing CSS/HTML
‚úÖ **Easier maintenance** - No React dependencies, webpack, or builds

---

## File Structure

```
iobroker.mcdu/
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ jsonConfig.json         # Complete admin UI definition (this is it!)
‚îÇ   ‚îî‚îÄ‚îÄ index_m.html            # Minimal wrapper (auto-generated by build tools)
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ mcdu-device.js          # USB HID communication
‚îÇ   ‚îú‚îÄ‚îÄ display-renderer.js     # Display rendering logic
‚îÇ   ‚îú‚îÄ‚îÄ page-manager.js         # Page system
‚îÇ   ‚îî‚îÄ‚îÄ state-mapper.js         # Map ioBroker states to MCDU display
‚îú‚îÄ‚îÄ main.js                     # Adapter entry point
‚îú‚îÄ‚îÄ io-package.json             # Adapter metadata
‚îî‚îÄ‚îÄ package.json
```

---

## Complete jsonConfig.json Schema

```json
{
  "i18n": true,
  "type": "tabs",
  "items": {
    "devices": {
      "type": "panel",
      "label": {
        "en": "MCDU Devices",
        "de": "MCDU-Ger√§te"
      },
      "icon": "mdi:devices",
      "items": {
        "_devicesInfo": {
          "type": "staticText",
          "text": {
            "en": "Register and manage multiple MCDU devices. You can search for devices on your network or add them manually.",
            "de": "Registriere und verwalte mehrere MCDU-Ger√§te. Du kannst im Netzwerk nach Ger√§ten suchen oder sie manuell hinzuf√ºgen."
          }
        },
        "_searchButton": {
          "type": "sendto",
          "command": "searchDevices",
          "label": {
            "en": "Search for MCDU devices",
            "de": "Nach MCDU-Ger√§ten suchen"
          },
          "icon": "mdi:magnify",
          "variant": "contained",
          "help": {
            "en": "Scan your network for WinWing MCDU devices",
            "de": "Scanne dein Netzwerk nach WinWing MCDU-Ger√§ten"
          }
        },
        "devices": {
          "type": "table",
          "label": {
            "en": "Registered Devices",
            "de": "Registrierte Ger√§te"
          },
          "items": [
            {
              "type": "text",
              "title": {
                "en": "Device Name",
                "de": "Ger√§tename"
              },
              "attr": "name",
              "width": "25%",
              "help": {
                "en": "Friendly name for this MCDU (e.g., Cockpit Main, Office)",
                "de": "Anzeigename f√ºr dieses MCDU (z.B. Cockpit Haupt, B√ºro)"
              }
            },
            {
              "type": "text",
              "title": {
                "en": "IP Address",
                "de": "IP-Adresse"
              },
              "attr": "ip",
              "width": "20%",
              "help": {
                "en": "IP address or hostname of the MCDU device",
                "de": "IP-Adresse oder Hostname des MCDU-Ger√§ts"
              }
            },
            {
              "type": "number",
              "title": {
                "en": "Port",
                "de": "Port"
              },
              "attr": "port",
              "width": "15%",
              "default": 5000,
              "help": {
                "en": "Network port (usually 5000)",
                "de": "Netzwerk-Port (normalerweise 5000)"
              }
            },
            {
              "type": "select",
              "title": {
                "en": "Connection Type",
                "de": "Verbindungstyp"
              },
              "attr": "connectionType",
              "width": "20%",
              "options": [
                { "value": "usb", "label": "USB HID" },
                { "value": "network", "label": "Network/IP" }
              ],
              "default": "network",
              "help": {
                "en": "Connection method (USB or network)",
                "de": "Verbindungsmethode (USB oder Netzwerk)"
              }
            },
            {
              "type": "checkbox",
              "title": {
                "en": "Active",
                "de": "Aktiv"
              },
              "attr": "enabled",
              "width": "10%",
              "default": true,
              "help": {
                "en": "Enable/disable this device",
                "de": "Ger√§t aktivieren/deaktivieren"
              }
            }
          ]
        },
        "selectedDevice": {
          "type": "select",
          "label": {
            "en": "Configure Device",
            "de": "Ger√§t konfigurieren"
          },
          "sm": 12,
          "help": {
            "en": "Select which MCDU device to configure in the Pages and Buttons tabs",
            "de": "W√§hle welches MCDU-Ger√§t in den Seiten- und Tasten-Tabs konfiguriert werden soll"
          },
          "options": "native.devices.map((d, i) => ({ value: i, label: d.name }))"
        }
      }
    },
    "connection": {
      "type": "panel",
      "label": {
        "en": "Display Settings",
        "de": "Display-Einstellungen"
      },
      "icon": "mdi:brightness-6",
      "items": {
        "_brightnessInfo": {
          "type": "staticText",
          "text": {
            "en": "Configure display and button brightness. Enable light sensor for automatic adjustment.",
            "de": "Konfiguriere Display- und Tastenhelligkeit. Aktiviere Lichtsensor f√ºr automatische Anpassung."
          }
        },
        "displayBrightness": {
          "type": "slider",
          "label": {
            "en": "Display Brightness",
            "de": "Display-Helligkeit"
          },
          "min": 0,
          "max": 100,
          "step": 5,
          "unit": "%",
          "default": 50,
          "help": {
            "en": "Manual brightness for the MCDU display (0-100%)",
            "de": "Manuelle Helligkeit f√ºr das MCDU-Display (0-100%)"
          }
        },
        "buttonBrightness": {
          "type": "slider",
          "label": {
            "en": "Button Backlight Brightness",
            "de": "Tastenhintergrund-Helligkeit"
          },
          "min": 0,
          "max": 100,
          "step": 5,
          "unit": "%",
          "default": 50,
          "help": {
            "en": "Manual brightness for button backlighting (0-100%)",
            "de": "Manuelle Helligkeit f√ºr Tastenhintergrundbeleuchtung (0-100%)"
          }
        },
        "lightSensorEnabled": {
          "type": "checkbox",
          "label": {
            "en": "Enable Light Sensor",
            "de": "Lichtsensor aktivieren"
          },
          "default": false,
          "help": {
            "en": "Use light sensor for automatic brightness adjustment",
            "de": "Lichtsensor f√ºr automatische Helligkeitsanpassung verwenden"
          }
        },
        "lightSensorStateId": {
          "type": "objectId",
          "label": {
            "en": "Light Sensor State",
            "de": "Lichtsensor-Zustand"
          },
          "filter": {
            "type": "state"
          },
          "hidden": "!data.lightSensorEnabled",
          "help": {
            "en": "ioBroker state that provides light sensor data (lux)",
            "de": "ioBroker-Zustand der Lichtsensor-Daten liefert (Lux)"
          }
        },
        "_brightnessNote": {
          "type": "staticText",
          "text": {
            "en": "Note: Manual brightness values are used when light sensor is disabled or unavailable.",
            "de": "Hinweis: Manuelle Helligkeitswerte werden verwendet wenn der Lichtsensor deaktiviert oder nicht verf√ºgbar ist."
          },
          "style": {
            "fontSize": "smaller",
            "fontStyle": "italic"
          }
        }
      }
    },
    "pages": {
      "type": "panel",
      "label": {
        "en": "Pages",
        "de": "Seiten"
      },
      "icon": "mdi:book-open-page-variant",
      "items": {
        "_pagesInfo": {
          "type": "staticText",
          "text": {
            "en": "Configure pages using templates or custom layouts. Templates provide pre-built page structures that automatically map to ioBroker metadata (function, room, type).",
            "de": "Konfiguriere Seiten mit Vorlagen oder benutzerdefinierten Layouts. Vorlagen bieten vordefinierte Seitenstrukturen die automatisch auf ioBroker-Metadaten (Funktion, Raum, Typ) abgebildet werden."
          }
        },
        "pages": {
          "type": "table",
          "label": {
            "en": "MCDU Pages",
            "de": "MCDU-Seiten"
          },
          "items": [
            {
              "type": "text",
              "title": {
                "en": "Page Name",
                "de": "Seitenname"
              },
              "attr": "name",
              "width": "12%",
              "help": {
                "en": "Short name shown in header (max 6 chars, e.g., DATA, MENU, INIT)",
                "de": "Kurzname in Kopfzeile (max. 6 Zeichen, z.B. DATA, MENU, INIT)"
              }
            },
            {
              "type": "text",
              "title": {
                "en": "Page Title",
                "de": "Seitentitel"
              },
              "attr": "title",
              "width": "20%",
              "help": {
                "en": "Full title shown at top of page (e.g., SYSTEM DATA)",
                "de": "Vollst√§ndiger Titel oben auf der Seite (z.B. SYSTEMDATEN)"
              }
            },
            {
              "type": "select",
              "title": {
                "en": "Template",
                "de": "Vorlage"
              },
              "attr": "template",
              "width": "18%",
              "options": [
                { "value": "custom", "label": { "en": "Custom", "de": "Benutzerdefiniert" } },
                { "value": "solar", "label": { "en": "Solar Panel", "de": "Solaranlage" } },
                { "value": "heating", "label": { "en": "Heating Control", "de": "Heizungssteuerung" } },
                { "value": "weather", "label": { "en": "Weather Display", "de": "Wetteranzeige" } },
                { "value": "room-living", "label": { "en": "Living Room", "de": "Wohnzimmer" } },
                { "value": "room-bedroom", "label": { "en": "Bedroom", "de": "Schlafzimmer" } },
                { "value": "room-kitchen", "label": { "en": "Kitchen", "de": "K√ºche" } },
                { "value": "room-generic", "label": { "en": "Generic Room", "de": "Generischer Raum" } }
              ],
              "default": "custom",
              "help": {
                "en": "Select a template or use custom layout",
                "de": "W√§hle eine Vorlage oder nutze benutzerdefiniertes Layout"
              }
            },
            {
              "type": "panel",
              "title": {
                "en": "Template Mapping",
                "de": "Vorlagen-Zuordnung"
              },
              "attr": "templateMapping",
              "width": "25%",
              "hidden": "data.template === 'custom'",
              "help": {
                "en": "Map template fields to ioBroker states",
                "de": "Ordne Vorlagenfelder ioBroker-Zust√§nden zu"
              },
              "items": {
                "_templateHelp": {
                  "type": "staticText",
                  "text": {
                    "en": "Map the template's predefined fields to your ioBroker states. The adapter will use metadata (function, room, type) to suggest appropriate states.",
                    "de": "Ordne die vordefinierten Felder der Vorlage deinen ioBroker-Zust√§nden zu. Der Adapter nutzt Metadaten (Funktion, Raum, Typ) um passende Zust√§nde vorzuschlagen."
                  }
                }
              }
            },
            {
              "type": "table",
              "title": {
                "en": "Custom Lines",
                "de": "Benutzerdefinierte Zeilen"
              },
              "attr": "lines",
              "width": "25%",
              "hidden": "data.template !== 'custom'",
              "items": [
                {
                  "type": "text",
                  "title": {
                    "en": "Label",
                    "de": "Beschriftung"
                  },
                  "attr": "label",
                  "width": "25%",
                  "help": {
                    "en": "Left-aligned label (e.g., WEATHER, SOLAR)",
                    "de": "Linksb√ºndige Beschriftung (z.B. WETTER, SOLAR)"
                  }
                },
                {
                  "type": "objectId",
                  "title": {
                    "en": "State",
                    "de": "Zustand"
                  },
                  "attr": "stateId",
                  "width": "50%",
                  "filter": {
                    "type": "state"
                  },
                  "help": {
                    "en": "ioBroker state to display",
                    "de": "Anzuzeigender ioBroker-Zustand"
                  }
                },
                {
                  "type": "text",
                  "title": {
                    "en": "Format",
                    "de": "Format"
                  },
                  "attr": "format",
                  "width": "25%",
                  "default": "{{value}}",
                  "help": {
                    "en": "Template with {{value}}, {{timestamp}}, etc.",
                    "de": "Vorlage mit {{value}}, {{timestamp}}, etc."
                  }
                }
              ]
            }
          ]
        }
      }
    },
    "buttons": {
      "type": "panel",
      "label": {
        "en": "Button Mappings",
        "de": "Tastenzuordnungen"
      },
      "icon": "mdi:keyboard",
      "items": {
        "_buttonsInfo": {
          "type": "staticText",
          "text": {
            "en": "Map MCDU buttons to actions. Line Select Keys (LSK) can control states, navigate pages, or trigger scripts.",
            "de": "Ordne MCDU-Tasten Aktionen zu. Line Select Keys (LSK) k√∂nnen Zust√§nde steuern, Seiten navigieren oder Skripte ausl√∂sen."
          }
        },
        "buttonMappings": {
          "type": "table",
          "label": {
            "en": "Button Actions",
            "de": "Tastenaktionen"
          },
          "items": [
            {
              "type": "select",
              "title": {
                "en": "Button",
                "de": "Taste"
              },
              "attr": "button",
              "width": "20%",
              "options": [
                { "value": "LSK_L1", "label": "LSK L1" },
                { "value": "LSK_L2", "label": "LSK L2" },
                { "value": "LSK_L3", "label": "LSK L3" },
                { "value": "LSK_L4", "label": "LSK L4" },
                { "value": "LSK_L5", "label": "LSK L5" },
                { "value": "LSK_L6", "label": "LSK L6" },
                { "value": "LSK_R1", "label": "LSK R1" },
                { "value": "LSK_R2", "label": "LSK R2" },
                { "value": "LSK_R3", "label": "LSK R3" },
                { "value": "LSK_R4", "label": "LSK R4" },
                { "value": "LSK_R5", "label": "LSK R5" },
                { "value": "LSK_R6", "label": "LSK R6" },
                { "value": "DIR", "label": "DIR" },
                { "value": "PROG", "label": "PROG" },
                { "value": "PERF", "label": "PERF" },
                { "value": "INIT", "label": "INIT" },
                { "value": "DATA", "label": "DATA" },
                { "value": "MENU", "label": "MENU" }
              ],
              "help": {
                "en": "Physical button on the MCDU",
                "de": "Physische Taste auf dem MCDU"
              }
            },
            {
              "type": "select",
              "title": {
                "en": "Action",
                "de": "Aktion"
              },
              "attr": "action",
              "width": "20%",
              "options": [
                { "value": "setState", "label": { "en": "Set State", "de": "Zustand setzen" } },
                { "value": "toggle", "label": { "en": "Toggle State", "de": "Zustand umschalten" } },
                { "value": "navigate", "label": { "en": "Navigate to Page", "de": "Zu Seite navigieren" } },
                { "value": "script", "label": { "en": "Run Script", "de": "Skript ausf√ºhren" } }
              ],
              "help": {
                "en": "Type of action to perform",
                "de": "Art der auszuf√ºhrenden Aktion"
              }
            },
            {
              "type": "objectId",
              "title": {
                "en": "Target State",
                "de": "Zielzustand"
              },
              "attr": "stateId",
              "width": "30%",
              "filter": {
                "type": "state"
              },
              "hidden": "data.action === 'navigate' || data.action === 'script'",
              "help": {
                "en": "ioBroker state to control (for setState/toggle actions)",
                "de": "Zu steuernder ioBroker-Zustand (f√ºr setState/toggle-Aktionen)"
              }
            },
            {
              "type": "text",
              "title": {
                "en": "Value / Page / Script",
                "de": "Wert / Seite / Skript"
              },
              "attr": "value",
              "width": "30%",
              "help": {
                "en": "Value to set, page name to navigate to, or script ID to run",
                "de": "Zu setzender Wert, Seitenname zur Navigation oder auszuf√ºhrende Skript-ID"
              }
            }
          ]
        }
      }
    },
    "configuration": {
      "type": "panel",
      "label": {
        "en": "Configuration",
        "de": "Konfiguration"
      },
      "icon": "mdi:content-save",
      "items": {
        "_configInfo": {
          "type": "staticText",
          "text": {
            "en": "Export your complete MCDU configuration to a file or import a previously saved configuration. This includes all devices, pages, and button mappings.",
            "de": "Exportiere deine vollst√§ndige MCDU-Konfiguration in eine Datei oder importiere eine zuvor gespeicherte Konfiguration. Dies beinhaltet alle Ger√§te, Seiten und Tastenzuordnungen."
          }
        },
        "_exportButton": {
          "type": "sendto",
          "command": "exportConfig",
          "label": {
            "en": "Export Configuration",
            "de": "Konfiguration exportieren"
          },
          "icon": "mdi:download",
          "variant": "contained",
          "help": {
            "en": "Download current configuration as JSON file",
            "de": "Aktuelle Konfiguration als JSON-Datei herunterladen"
          }
        },
        "_importButton": {
          "type": "sendto",
          "command": "importConfig",
          "label": {
            "en": "Import Configuration",
            "de": "Konfiguration importieren"
          },
          "icon": "mdi:upload",
          "variant": "contained",
          "help": {
            "en": "Upload and restore configuration from JSON file",
            "de": "Konfiguration aus JSON-Datei hochladen und wiederherstellen"
          }
        },
        "_configWarning": {
          "type": "staticText",
          "text": {
            "en": "‚ö†Ô∏è Importing will overwrite your current configuration. Make sure to export first if you want to keep your current settings!",
            "de": "‚ö†Ô∏è Importieren √ºberschreibt deine aktuelle Konfiguration. Stelle sicher, dass du zuerst exportierst wenn du deine aktuellen Einstellungen behalten m√∂chtest!"
          },
          "style": {
            "color": "orange",
            "fontWeight": "bold"
          }
        }
      }
    },
    "advanced": {
      "type": "panel",
      "label": {
        "en": "Advanced",
        "de": "Erweitert"
      },
      "icon": "mdi:cog",
      "items": {
        "_advancedInfo": {
          "type": "staticText",
          "text": {
            "en": "Advanced settings for debugging and customization.",
            "de": "Erweiterte Einstellungen f√ºr Debugging und Anpassung."
          }
        },
        "debugMode": {
          "type": "checkbox",
          "label": {
            "en": "Debug Mode",
            "de": "Debug-Modus"
          },
          "default": false,
          "help": {
            "en": "Enable verbose logging for troubleshooting",
            "de": "Aktiviere ausf√ºhrliches Logging zur Fehlerbehebung"
          }
        },
        "refreshInterval": {
          "type": "number",
          "label": {
            "en": "Display Refresh Interval (ms)",
            "de": "Display-Aktualisierungsintervall (ms)"
          },
          "min": 100,
          "max": 5000,
          "step": 100,
          "default": 1000,
          "help": {
            "en": "How often to refresh the display (100-5000ms)",
            "de": "Wie oft das Display aktualisiert werden soll (100-5000ms)"
          }
        },
        "reconnectDelay": {
          "type": "number",
          "label": {
            "en": "USB Reconnect Delay (ms)",
            "de": "USB-Wiederverbindungsverz√∂gerung (ms)"
          },
          "min": 1000,
          "max": 30000,
          "step": 1000,
          "default": 5000,
          "help": {
            "en": "Delay before attempting to reconnect after USB disconnect",
            "de": "Verz√∂gerung vor erneutem Verbindungsversuch nach USB-Trennung"
          }
        }
      }
    }
  }
}
```

---

## io-package.json Native Schema

The `native` section in `io-package.json` defines the default configuration:

```json
{
  "native": {
    "devices": [
      {
        "name": "Main MCDU",
        "ip": "192.168.1.100",
        "port": 5000,
        "connectionType": "network",
        "enabled": true
      }
    ],
    "selectedDevice": 0,
    "displayBrightness": 50,
    "buttonBrightness": 50,
    "lightSensorEnabled": false,
    "lightSensorStateId": "",
    "debugMode": false,
    "refreshInterval": 1000,
    "reconnectDelay": 5000,
    "pages": [
      {
        "name": "DATA",
        "title": "SYSTEM DATA",
        "template": "custom",
        "templateMapping": {},
        "lines": [
          {
            "label": "WEATHER",
            "stateId": "",
            "format": "{{value}}¬∞C"
          },
          {
            "label": "SOLAR",
            "stateId": "",
            "format": "{{value}}W"
          }
        ]
      },
      {
        "name": "SOLAR",
        "title": "SOLAR PANEL",
        "template": "solar",
        "templateMapping": {
          "currentPower": "solar.0.power.current",
          "homeConsumption": "solar.0.consumption.home",
          "gridExport": "solar.0.power.grid",
          "batteryCharge": "solar.0.battery.charge"
        },
        "lines": []
      },
      {
        "name": "LIVING",
        "title": "LIVING ROOM",
        "template": "room-living",
        "templateMapping": {
          "temperature": "temp.living",
          "humidity": "hum.living",
          "lights": "lights.living",
          "heating": "heating.living"
        },
        "lines": []
      }
    ],
    "buttonMappings": [
      {
        "button": "LSK_L1",
        "action": "toggle",
        "stateId": "",
        "value": ""
      }
    ]
  }
}
```

---

## JSON Config Component Guide

### Key Components Used

#### 1. **tabs** (Root Container)
Organizes settings into Connection, Pages, Buttons, and Advanced tabs.

#### 2. **panel** (Tab Content)
Each tab is a panel with icon and label.

#### 3. **table** (Complex Arrays)
Used for:
- **Pages table:** Add/edit/delete pages
- **Lines table (nested):** Add/edit/delete lines within each page
- **Button mappings table:** Add/edit/delete button actions

**Why tables?**
- Built-in add/delete/reorder buttons
- Column headers and widths
- Nested tables for hierarchical data (pages ‚Üí lines)

#### 4. **objectId** (State Selection)
Native ioBroker state picker with:
- Tree browser of all states
- Filter by type
- Auto-completion
- Visual state explorer

**Usage:**
```json
{
  "type": "objectId",
  "attr": "stateId",
  "filter": { "type": "state" }
}
```

#### 5. **select** (Dropdowns)
For button names and action types with predefined options.

#### 6. **slider** (Brightness)
Visual slider with min/max/step and unit display.

#### 7. **text** (Simple Inputs)
For USB IDs, labels, formats, and custom values.

#### 8. **checkbox** (Toggles)
For debug mode and other boolean settings.

#### 9. **number** (Numeric Inputs)
For intervals and delays with validation.

#### 10. **staticText** (Help Text)
Informational text at the top of each section.

---

## Conditional Visibility

The `hidden` attribute dynamically shows/hides fields:

```json
{
  "type": "objectId",
  "attr": "stateId",
  "hidden": "data.action === 'navigate' || data.action === 'script'"
}
```

**Use case:** Only show "Target State" field when action is `setState` or `toggle`, hide it for `navigate` and `script` actions.

---

## Table Nesting Example

**Pages contain lines:**

```json
{
  "type": "table",
  "attr": "pages",
  "items": [
    { "type": "text", "attr": "name", "title": "Page Name" },
    { "type": "text", "attr": "title", "title": "Page Title" },
    {
      "type": "table",
      "attr": "lines",
      "title": "Lines",
      "items": [
        { "type": "text", "attr": "label", "title": "Label" },
        { "type": "objectId", "attr": "stateId", "title": "State" },
        { "type": "text", "attr": "format", "title": "Format" }
      ]
    }
  ]
}
```

This creates a **table within a table**:
- Outer table: pages (name, title, lines)
- Inner table: lines for each page (label, stateId, format)

Users can:
1. Add/delete pages in the outer table
2. Click on a page row to expand and edit its lines
3. Add/delete lines in the nested table

---

## Internationalization (i18n)

All user-facing text supports multiple languages:

```json
{
  "label": {
    "en": "Connection",
    "de": "Verbindung"
  }
}
```

**Supported languages:**
- `en` - English
- `de` - German (Deutsch)
- `ru` - Russian
- `pt` - Portuguese
- `nl` - Dutch
- `fr` - French
- `it` - Italian
- `es` - Spanish
- `pl` - Polish
- `uk` - Ukrainian
- `zh-cn` - Chinese (simplified)

---

## Admin UI Workflow

### User Experience

1. **Install adapter** through ioBroker admin
2. **Open instance settings** ‚Üí Sees 4 tabs
3. **Connection tab:**
   - USB IDs auto-filled (defaults work for WinWing MCDU)
   - Adjust brightness slider
4. **Pages tab:**
   - Click "Add" to create new page
   - Enter page name (e.g., "DATA") and title (e.g., "SYSTEM DATA")
   - Click on page row to expand lines table
   - Click "Add" in lines table to add data lines
   - Use state picker to select ioBroker states
   - Set format templates (e.g., "{{value}}¬∞C")
5. **Buttons tab:**
   - Click "Add" to map a button
   - Select button from dropdown (e.g., "LSK L1")
   - Choose action (toggle, setState, navigate, script)
   - Pick target state (if toggle/setState)
   - Enter value/page/script ID
6. **Advanced tab:**
   - Enable debug mode if needed
   - Adjust refresh intervals
7. **Save** ‚Üí Adapter restarts with new config

---

## Implementation Checklist

### Phase 1: JSON Config Setup
- [x] Create `admin/jsonConfig.json` with complete schema
- [ ] Test connection tab (USB IDs, brightness slider)
- [ ] Test pages table (add/edit/delete pages)
- [ ] Test nested lines table (add/edit/delete lines per page)
- [ ] Test button mappings table
- [ ] Test objectId state picker
- [ ] Verify conditional visibility (`hidden` attribute)
- [ ] Add translations (at minimum: en, de)

### Phase 2: Backend Integration
- [ ] Read `this.config.pages` in `main.js`
- [ ] Read `this.config.buttonMappings` in `main.js`
- [ ] Subscribe to states referenced in pages
- [ ] Handle button press events
- [ ] Render pages on MCDU display
- [ ] Execute button actions (setState, toggle, navigate, script)

### Phase 3: Testing
- [ ] Add/remove pages via admin UI
- [ ] Add/remove lines via nested table
- [ ] Map buttons to actions
- [ ] Verify state changes update display
- [ ] Test all action types (setState, toggle, navigate, script)
- [ ] Test USB reconnection logic
- [ ] Verify brightness control

### Phase 4: Documentation
- [ ] Update README with JSON Config screenshots
- [ ] Add example configurations
- [ ] Document template variables ({{value}}, {{timestamp}})
- [ ] Write troubleshooting guide

---

## Advantages Over React UI

| Aspect | React UI | JSON Config |
|--------|----------|-------------|
| **Development time** | 3-5 days | 1-2 hours |
| **Code to maintain** | ~1000+ lines | ~300 lines JSON |
| **Dependencies** | React, webpack, babel | None |
| **Build process** | Complex (webpack) | None |
| **i18n support** | Manual | Built-in |
| **Responsive design** | Manual CSS | Automatic |
| **State management** | Manual | Automatic |
| **Validation** | Manual | Built-in |
| **Accessibility** | Manual | Built-in |

---

## Example: User Creates a Template-Based Page

**Scenario 1: Using Solar Template**

1. User clicks "Add" in Pages table
2. New row appears with empty fields
3. User fills in:
   - Name: `SOLAR`
   - Title: `SOLAR PANEL`
   - Template: Select "Solar Panel" from dropdown
4. Template mapping panel appears with predefined fields:
   - Current Power ‚Üí User selects `solar.0.power.current`
   - Home Consumption ‚Üí User selects `solar.0.consumption.home`
   - Grid Export ‚Üí User selects `solar.0.power.grid`
   - Battery Charge ‚Üí User selects `solar.0.battery.charge`
5. User clicks "Save"
6. Adapter receives config:
   ```json
   {
     "name": "SOLAR",
     "title": "SOLAR PANEL",
     "template": "solar",
     "templateMapping": {
       "currentPower": "solar.0.power.current",
       "homeConsumption": "solar.0.consumption.home",
       "gridExport": "solar.0.power.grid",
       "batteryCharge": "solar.0.battery.charge"
     },
     "lines": []
   }
   ```

**Scenario 2: Using Custom Template**

1. User clicks "Add" in Pages table
2. User fills in:
   - Name: `DATA`
   - Title: `SYSTEM DATA`
   - Template: Select "Custom"
3. Custom lines table appears (traditional approach)
4. User clicks "Add" in lines table and fills in manually:
   - Label: `WEATHER`
   - State: `weather.0.current.temperature`
   - Format: `{{value}}¬∞C`
5. User clicks "Save"
6. Adapter receives config:
   ```json
   {
     "name": "DATA",
     "title": "SYSTEM DATA",
     "template": "custom",
     "templateMapping": {},
     "lines": [
       {
         "label": "WEATHER",
         "stateId": "weather.0.current.temperature",
         "format": "{{value}}¬∞C"
       }
     ]
   }
   ```

---

## Summary of New Features

### üÜï Multi-Device Support
- **Devices tab** - Register and manage multiple MCDU devices
- Network device search (automatic discovery)
- Manual device registration (IP + port)
- Device selection dropdown for configuration
- Per-device page and button mappings

### üé® Template System
- **Template selector** in page editor
- Pre-built templates: Solar, Heating, Weather, Room variants
- Template mapping panel (appears when template selected)
- Custom template for manual configuration
- Templates leverage ioBroker metadata (function, room, type, role)

### üíæ Configuration Management
- **Export configuration** to JSON file
- **Import configuration** from JSON file
- Backup and restore complete setup
- Share configurations between installations

### üí° Brightness Controls
- Separate display and button brightness sliders
- **Light sensor integration** - automatic brightness adjustment
- State picker for light sensor data
- Manual override when sensor disabled

### üîÑ Updated Workflows

**Template-based page creation:**
1. Select template (Solar, Heating, Weather, Room)
2. Map template fields to ioBroker states
3. Template handles layout, formatting, units automatically

**Custom page creation:**
1. Select "Custom" template
2. Manually add lines (traditional approach)
3. Full control over layout

**Multi-device workflow:**
1. Register devices (search or manual)
2. Select device to configure
3. Create pages for that device
4. Map buttons for that device

---

## Next Steps

1. **Create `admin/jsonConfig.json`** with the updated schema above
2. **Implement template engine** (see TEMPLATES-DESIGN.md)
3. **Implement multi-device support** (device manager, discovery)
4. **Test in ioBroker:** Install adapter, open settings, verify all UI elements work
5. **Implement backend logic** in `main.js` to read and use the configuration
6. **Document** with screenshots of the config UI and template examples

**Result:** Professional, native ioBroker admin UI with multi-device support, templates, and configuration management - all with ZERO custom React code! üéâ
